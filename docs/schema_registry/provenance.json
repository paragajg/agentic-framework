{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://agent-framework.io/schemas/provenance.json",
  "title": "Provenance Record",
  "description": "A structured record tracking the lineage, creation process, and audit trail of an artifact",
  "type": "object",
  "required": [
    "id",
    "actor_id",
    "actor_type",
    "timestamp",
    "artifact_id",
    "artifact_type"
  ],
  "properties": {
    "id": {
      "type": "string",
      "description": "Unique identifier for this provenance record",
      "pattern": "^prov_[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$",
      "examples": ["prov_850e8400-e29b-41d4-a716-446655440000"]
    },
    "actor_id": {
      "type": "string",
      "description": "Identifier of the actor (subagent, system, or human) that created or modified the artifact",
      "pattern": "^(subagent|system|human):[a-zA-Z0-9_@.-]+$",
      "examples": ["subagent:research-agent-001", "system:orchestrator", "human:user@company.com"]
    },
    "actor_type": {
      "type": "string",
      "enum": ["subagent", "system", "human"],
      "description": "Type of actor that performed the action",
      "examples": ["subagent"]
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp when the action was performed",
      "examples": ["2025-12-28T15:20:35Z"]
    },
    "artifact_id": {
      "type": "string",
      "description": "Identifier of the artifact this provenance record describes",
      "examples": ["550e8400-e29b-41d4-a716-446655440000"]
    },
    "artifact_type": {
      "type": "string",
      "description": "Type of the artifact (e.g., research_snippet, claim_verification, code_patch)",
      "examples": ["research_snippet", "claim_verification", "code_patch"]
    },
    "inputs_hash": {
      "type": "string",
      "description": "Cryptographic hash of input data used to create the artifact (SHA-256)",
      "pattern": "^[0-9a-f]{64}$",
      "examples": ["e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855"]
    },
    "outputs_hash": {
      "type": "string",
      "description": "Cryptographic hash of the output artifact (SHA-256)",
      "pattern": "^[0-9a-f]{64}$",
      "examples": ["d7a8fbb307d7809469ca9abcb0082e4f8d5651e46d3cdb762d02d0bf37c9e592"]
    },
    "tool_ids": {
      "type": "array",
      "description": "List of tools or MCP servers used in creating this artifact",
      "items": {
        "type": "string",
        "description": "Tool catalog ID or MCP server identifier"
      },
      "uniqueItems": true,
      "default": [],
      "examples": [["web_search", "document_read", "mcp:github"]]
    },
    "manifest_id": {
      "type": "string",
      "description": "Identifier of the workflow manifest under which this artifact was created",
      "examples": ["customer-support-workflow", "code-review-workflow"]
    },
    "version": {
      "type": "string",
      "description": "Version of the manifest at time of execution",
      "pattern": "^[0-9]+\\.[0-9]+\\.[0-9]+$",
      "examples": ["1.0.0", "2.1.3"]
    },
    "step_id": {
      "type": "string",
      "description": "Identifier of the specific step in the workflow that created this artifact",
      "examples": ["research-context", "verify-claims"]
    },
    "parent_provenance_ids": {
      "type": "array",
      "description": "Provenance IDs of artifacts that were inputs to this artifact (lineage chain)",
      "items": {
        "type": "string",
        "pattern": "^prov_[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$"
      },
      "default": [],
      "examples": [["prov_750e8400-e29b-41d4-a716-446655440001"]]
    },
    "execution_context": {
      "type": "object",
      "description": "Additional context about the execution environment",
      "properties": {
        "workflow_run_id": {
          "type": "string",
          "description": "Unique identifier for the workflow execution instance",
          "pattern": "^run_[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$"
        },
        "session_id": {
          "type": "string",
          "description": "Session identifier for the overall user session",
          "pattern": "^sess_[0-9a-zA-Z_-]+$"
        },
        "llm_model": {
          "type": "string",
          "description": "LLM model used (if applicable)",
          "examples": ["claude-sonnet-4-20250514", "gpt-4o", "llama3.1:70b"]
        },
        "llm_provider": {
          "type": "string",
          "description": "LLM provider used",
          "examples": ["anthropic", "openai", "local"]
        },
        "temperature": {
          "type": "number",
          "description": "Temperature setting for LLM generation",
          "minimum": 0.0,
          "maximum": 2.0
        },
        "max_tokens": {
          "type": "integer",
          "description": "Maximum tokens setting for LLM generation",
          "minimum": 1
        },
        "prompt_tokens": {
          "type": "integer",
          "description": "Number of tokens in the prompt",
          "minimum": 0
        },
        "completion_tokens": {
          "type": "integer",
          "description": "Number of tokens in the completion",
          "minimum": 0
        },
        "total_cost_usd": {
          "type": "number",
          "description": "Estimated cost of this operation in USD",
          "minimum": 0.0
        },
        "duration_ms": {
          "type": "integer",
          "description": "Duration of the operation in milliseconds",
          "minimum": 0
        }
      },
      "additionalProperties": true
    },
    "validation": {
      "type": "object",
      "description": "Validation results for the artifact",
      "properties": {
        "schema_validated": {
          "type": "boolean",
          "description": "Whether artifact passed JSON Schema validation",
          "default": true
        },
        "schema_ref": {
          "type": "string",
          "description": "Reference to the JSON Schema used for validation",
          "examples": ["schema_registry/research_snippet.json"]
        },
        "safety_checks_passed": {
          "type": "boolean",
          "description": "Whether artifact passed safety policy checks",
          "default": true
        },
        "pii_detected": {
          "type": "boolean",
          "description": "Whether PII was detected in the artifact",
          "default": false
        },
        "validation_errors": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "List of validation errors if any"
        }
      },
      "additionalProperties": false
    },
    "mutation_history": {
      "type": "array",
      "description": "History of mutations to this artifact (if modified after creation)",
      "items": {
        "type": "object",
        "required": ["timestamp", "actor_id", "action"],
        "properties": {
          "timestamp": {
            "type": "string",
            "format": "date-time",
            "description": "When the mutation occurred"
          },
          "actor_id": {
            "type": "string",
            "description": "Actor that performed the mutation"
          },
          "action": {
            "type": "string",
            "enum": ["update", "redact", "approve", "reject", "flag", "archive"],
            "description": "Type of mutation"
          },
          "reason": {
            "type": "string",
            "description": "Reason for the mutation",
            "maxLength": 500
          },
          "fields_changed": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "List of fields that were changed"
          }
        },
        "additionalProperties": false
      },
      "default": []
    },
    "metadata": {
      "type": "object",
      "description": "Additional metadata for this provenance record",
      "properties": {
        "environment": {
          "type": "string",
          "enum": ["development", "staging", "production"],
          "description": "Environment where artifact was created"
        },
        "git_commit": {
          "type": "string",
          "description": "Git commit SHA of the framework code at execution time",
          "pattern": "^[0-9a-f]{40}$"
        },
        "framework_version": {
          "type": "string",
          "description": "Version of the agent framework",
          "pattern": "^[0-9]+\\.[0-9]+\\.[0-9]+$"
        },
        "tags": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Tags for categorization and search"
        },
        "notes": {
          "type": "string",
          "description": "Additional notes or context",
          "maxLength": 2000
        }
      },
      "additionalProperties": true
    }
  },
  "additionalProperties": false,
  "examples": [
    {
      "id": "prov_850e8400-e29b-41d4-a716-446655440000",
      "actor_id": "subagent:research-agent-001",
      "actor_type": "subagent",
      "timestamp": "2025-12-28T15:20:35Z",
      "artifact_id": "550e8400-e29b-41d4-a716-446655440000",
      "artifact_type": "research_snippet",
      "inputs_hash": "e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855",
      "outputs_hash": "d7a8fbb307d7809469ca9abcb0082e4f8d5651e46d3cdb762d02d0bf37c9e592",
      "tool_ids": ["web_search", "document_read"],
      "manifest_id": "customer-support-workflow",
      "version": "1.0.0",
      "step_id": "research-context",
      "parent_provenance_ids": [],
      "execution_context": {
        "workflow_run_id": "run_950e8400-e29b-41d4-a716-446655440000",
        "session_id": "sess_abc123",
        "llm_model": "claude-sonnet-4-20250514",
        "llm_provider": "anthropic",
        "temperature": 0.7,
        "max_tokens": 4096,
        "prompt_tokens": 1250,
        "completion_tokens": 850,
        "total_cost_usd": 0.042,
        "duration_ms": 3500
      },
      "validation": {
        "schema_validated": true,
        "schema_ref": "schema_registry/research_snippet.json",
        "safety_checks_passed": true,
        "pii_detected": false,
        "validation_errors": []
      },
      "mutation_history": [],
      "metadata": {
        "environment": "production",
        "git_commit": "1234567890abcdef1234567890abcdef12345678",
        "framework_version": "1.0.0",
        "tags": ["customer-support", "research", "automated"],
        "notes": "Initial research phase completed successfully with high confidence"
      }
    }
  ]
}
